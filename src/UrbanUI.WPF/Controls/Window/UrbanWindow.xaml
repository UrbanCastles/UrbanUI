<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:UrbanUI.WPF.Controls"
                    xmlns:converters="clr-namespace:UrbanUI.WPF.Converters">

    <ControlTemplate x:Key="UrbanUI.WPF.WindowStyle" TargetType="{x:Type Window}">
        <AdornerDecorator>
            <Grid>
                <controls:ClipBorder x:Name="PART_MainGridContainer" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Grid x:Name="PART_TopBarGrid" MinHeight="35">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.Style>
                                <Style TargetType="Grid">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowStyle}" Value="None">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid x:Name="PART_dragGrid" IsHitTestVisible="True" Background="Transparent">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="15, 0 0 0">
                                    <Image x:Name="PART_windowIcon" Width="16" Height="16" Source="{TemplateBinding Icon}"/>

                                    <TextBlock x:Name="PART_windowTitle" Text="{TemplateBinding Title}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="15,0,0,0" TextTrimming="CharacterEllipsis" 
                                       IsEnabled="{TemplateBinding IsActive}" 
                                       FontSize="{TemplateBinding FontSize}"
                                       FontWeight="{TemplateBinding FontWeight}"
                                       FontFamily="{TemplateBinding FontFamily}"
                                       FontStyle="{TemplateBinding FontStyle}"
                                       FontStretch="{TemplateBinding FontStretch}"/>
                                </StackPanel>
                            </Grid>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Height="30" MaxHeight="30">
                                <controls:Button x:Name="PART_minimizeButton" Width="46" PathIconWidth="10" PathIconHeight="10" IconPath="M2048 819v205H0V819h2048z"/>
                                <controls:Button x:Name="PART_maximizeButton" Width="46" PathIconWidth="10" PathIconHeight="10" IconPath="M3 3v10h10V3H3zm9 9H4V4h8v8z"/>
                                <controls:Button x:Name="PART_restoreButton" Width="46" PathIconWidth="10" PathIconHeight="10" IconPath="M2048 1638h-410v410H0V410h410V0h1638v1638zM1434 614H205v1229h1229V614zm409-409H614v205h1024v1024h205V205z"/>
                                <controls:Button x:Name="PART_closeButton" Width="46" PathIconWidth="10" PathIconHeight="10" IconPath="m1169 1024l879 879l-145 145l-879-879l-879 879L0 1903l879-879L0 145L145 0l879 879L1903 0l145 145l-879 879z"/>
                            </StackPanel>
                        </Grid>

                        <Grid x:Name="SubContainerGrid" Grid.Row="1"
                          FocusVisualStyle="{x:Null}">
                            <ContentPresenter x:Name="PART_ContentPresenter" Margin="1" Content="{TemplateBinding Content}" />
                            <ResizeGrip HorizontalAlignment="Right" x:Name="PART_WindowResizeGrip" VerticalAlignment="Bottom" IsTabStop="False" Visibility="Collapsed" Grid.Row="1" Margin="4"/>
                        </Grid>

                    </Grid>
                </controls:ClipBorder>
            </Grid>

        </AdornerDecorator>

        <ControlTemplate.Triggers>
            <MultiTrigger>
                <MultiTrigger.Conditions>
                    <Condition Property="ResizeMode" Value="CanResize"/>
                    <Condition Property="WindowState" Value="Maximized"/>
                </MultiTrigger.Conditions>
                <Setter Property="Visibility" TargetName="PART_WindowResizeGrip" Value="Collapsed"/>
            </MultiTrigger>
            <Trigger Property="WindowStyle" Value="None">
                <Setter TargetName="PART_dragGrid" Property="IsHitTestVisible" Value="False"/>
                <Setter TargetName="PART_TopBarGrid" Property="Visibility" Value="Collapsed"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style x:Key="UrbanUI.WPF.WindowStyleTemplate" BasedOn="{StaticResource {x:Type Window}}" TargetType="{x:Type controls:UrbanWindow}">

        <Setter Property="WindowStyle" Value="SingleBorderWindow" />
        <Setter Property="RenderOptions.BitmapScalingMode" Value="Linear" />
        <Setter Property="RenderOptions.EdgeMode" Value="Unspecified" />
        <Setter Property="UseLayoutRounding" Value="True" />
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="Template" Value="{StaticResource UrbanUI.WPF.WindowStyle}"/>
        <Setter Property="OverridesDefaultStyle" Value="True"/>
    </Style>

    <Style BasedOn="{StaticResource UrbanUI.WPF.WindowStyleTemplate}" TargetType="{x:Type controls:UrbanWindow}"/>


</ResourceDictionary>